
<div id="purchases">
  <h2 class="purchase_list">List of purchases</h2>

  <% @receipts_by_month.each do |month, purchases| %>
    <%= month.strftime("%B %Y") %>
    <% monthly_cost = [] %>
    <% monthly_emission = [] %>

    <ul>
     <% purchases.each do |purchase| %>
        <li><%= Date.parse(purchase.date.to_s).strftime("%D") %>
          <em><%= purchase.kind %></em>,
          $<%= purchase.cost %>,
          <strong><%= purchase.emission %> kg</strong> of carbon dioxide
          <% monthly_cost << purchase.cost.to_f %>
          <% monthly_emission << purchase.emission.to_f %>
       </li>
     <% end %>
     <% month_total_cost = monthly_cost.inject { |sum, x| sum + x }  %>
     <% month_total_emission = monthly_emission.inject { |sum, x| sum + x }  %>

     <li>The total cost for <%= month.strftime("%B") %> is <%= number_to_currency(month_total_cost) %></li>
     <li>The total emission for <%= month.strftime("%B") %> is <%= number_with_precision(month_total_emission, :precision => 2) %> kg</li>
    </ul>
  <% end %>

  <h3 class="total_cost">
    <% if @receipts == [] %>      $<%= 0 %>
    <% else %>
      <% every_cost = Array.new %>
      <% @receipts.each do |r| %>
        <% every_cost.push(r[:cost].to_f) %>
      <% end %>
      <%= number_to_currency(every_cost.inject { |result, element| result + element }.round(2)) %>
    <% end %>
    spent in total
  </h3>
  <h3 class="total_emission">
    <% if @receipts == [] %>
      <% e = 0 %>
      <%= e %>
    <% else %>
      <% every_emission = Array.new %>
      <% @receipts.each do |r| %>
        <% every_emission.push(r.emission.to_i) %>
      <% end %>
      <% e = every_emission.inject { |result, element| result + element }.round(2) %>
      <%= number_with_delimiter(e) %>
    <% end %>
    kg of carbon dioxide emitted
  </h3>
  <h3 class="plastic_bags">Equivalent to <%= number_with_delimiter(e * 100) %> plastic bags</h3>


  <h4 id="new_purchase"><%= link_to "Enter New Purchase", new_receipt_path %></h4>
</div>

<h2>My Goals</h2>

<table>
  <tr>
    <th>Goal name</th>
    <th>Description</th>
    <th>User</th>
    <th>Start time</th>
    <th>End time</th>
    <th>Status</th>
    <th></th>
    <th></th>
    <th></th>
  </tr>

  <% @user.goals.each do |goal| %>
    <tr>
      <td><%= goal.goal_name %></td>
      <td><%= goal.description %></td>
      <td><%= goal.user.email %></td>
      <td><%= Date.parse(goal.start_time.to_s).strftime("%b %e, %Y") %></td>
      <td><%= Date.parse(goal.end_time.to_s).strftime("%b %e, %Y") %></td>
      <td><%= goal.status %></td>
      <td><%= link_to 'Show', goal %></td>
      <td><%= link_to 'Edit', edit_goal_path(goal) %></td>
      <td><%= link_to 'Destroy', goal, method: :delete, data: { confirm: 'Are you sure?' } %></td>
    </tr>
  <% end %>
</table>

<br />
<%= link_to 'New Goal', new_goal_path %>


