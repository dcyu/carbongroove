<!--nav begin -->
<nav class="navbar group">
   <div class="nav-inner">
        <div ><%= link_to "CarbonGroove", root_path, :class=>"col-2-3 logo" %></div>
        <div class="col-1-3 login right">
          <ul id="nav">
            <li class="name">Hello, <%= current_user.name %>!</li>
          </ul>
        </div>
    </div>
</nav>


  <div class="wrapper">
    <div class="col-1-4 main box-offset">
        <%= image_tag current_user.pic_url if current_user.pic_url.present? %>
        <div class="name margin-top group"><%= current_user.name %></div>
        <div class="profile content-text"><p><%= current_user.bio %></p></div>
        <%= link_to "Add an account!", '#accountModal', :data => {:toggle => "modal"} %>
        <div class="goal group-sub border">Your goal progress</div>
        <a id="pop" class="btn btn-success small pull-right" rel="popover" data-placement="bottom" data-content="#popover-form" data-original-title="">Set goal</a>



        <div id="popover-form" style="display: none">
          <%= form_for(@goal) do |f| %>
  <% if @goal.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@goal.errors.count, "error") %> prohibited this goal from being saved:</h2>

      <ul>
      <% @goal.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :goal_name %><br />
    <%= f.text_field :goal_name %>
  </div>
  <div class="field">
    <%= f.label :description %><br />
    <%= f.text_area :description %>
  </div>
  <div class="field">
    <%= f.label :Reduce_Emissions_By %><br />
    <%= f.select :target_emission, options_for_select(Goal::TARGET_GOAL) %>

  </div>
  <div class="field">
    <%= f.hidden_field :user_id, value: current_user.id %>
  </div>


  <div class="field">
    <%= f.label :start_time %><br />
    <%= f.date_select :start_time %>
  </div>
  <div class="field">
    <%= f.label :end_time %><br />
    <%= f.date_select :end_time %>
  </div>
  <div class="field">
    <%= f.label :status %><br />
    <%= f.select :status, options_for_select(["Not Started","In Progress", "Completed", "Screw It"]) %>
  </div>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>


        </div>

        <div id="arc"></div>

        <div class="goal group-sub">Goal List </div>
        <div class" goal group">
          <div class="accordion" id="accordion2">
            <div class="accordion-group">
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                           <% @user.goals.each do |goal| %>
                           <%= goal.goal_name %>
                           <% end %>
                    </a>
                </div>
                <div id="collapseOne" class="accordion-body collapse in">
                  <div class="accordion-inner">start Date : Mar 15 2013</div>
                </div>
            </div>
          </div>

        </div>





        <table class ="goal table table-hover">
          <tr>
            <!-- <th>Goal name</th> -->
            <!-- <th>Description</th> -->
            <!-- <th>Target Emission (reduce by)</th> -->
            <!-- <th>Start time</th> -->
            <!-- <th>End time</th> -->
            <!-- <th>Status</th> -->
          </tr>

          <% @user.goals.each do |goal| %>
           <!--  <tr>
              <td><%= goal.goal_name %></td>
            </tr>
            <tr>
               <td><%= goal.description %></td>
            </tr>

            <tr>
              <td><%= goal.target_emission %>%</td>
            </tr>
            <tr>
              <td><%= Date.parse(goal.start_time.to_s).strftime("%b %e, %Y") %></td>
            </tr>
            <tr>
              <td><%= Date.parse(goal.end_time.to_s).strftime("%b %e, %Y") %></td>
            </tr>
            <tr>
              <td><%= goal.status %></td>
            </tr>
            <tr>
              <td><%= link_to 'Show', goal %></td>
            </tr>
            <tr>
              <td><%= link_to 'Edit', edit_goal_path(goal) %></td>
            </tr>
            <tr>
              <td><%= link_to 'Destroy', goal, method: :delete, data: { confirm: 'Are you sure?' } %></td>
            </tr> -->
          <% end %>
        </table>
        <div class="group">
          <div class="facebook log"><%= image_tag("facebook-bw.png") %></div>
          <div class="twitter log"><%= image_tag("twitter-bw.png") %></div>
        </div>
    </div> <!--col-1-4 end-->
    <div class="col-3-4 dashboard box-offset">
      <!-- <div class="col-3-3 box-offset"> -->
        <div class="col-3-3 month group-header">
          <div class="month-title"><%= @view_date.strftime("%B %Y") %></div>
          <div class="arrow-left"><%= link_to(image_tag("arrow-left.png"), "/users/#{current_user.id}/#{@view_date - 1.month}") %></div>
          <div class="arrow-right"><%= link_to(image_tag("arrow-right.png"), "/users/#{current_user.id}/#{@view_date + 1.month}") %></div>
        </div>
            <table id="data">
          <tfoot>
            <tr>
            <% @intervals.sort_by {|obj| obj.start_range}.each do |i| %>
              <th><%= i.start_range.strftime("%e") %></th>
            <% end %>
            </tr>
          </tfoot>
          <tbody>
            <tr>
            <% @intervals.sort_by {|obj| obj.start_range}.each do |i| %>
              <td><%= i.total_emission %></td>
            <% end %>
            </tr>
          </tbody>
          </table>
        <div id="holder"></div>

      <div class="col-1-3 purchase group-sub">
        <div class="left">Purchase List</div>
        <div class="twitter log right"><%= link_to image_tag("pencil.png"), new_receipt_path %></div>
      </div>

      <div class="col-3-3 category box-offset">
            <table class="table table-hover">
              <tbody>
                <tr>
                  <th>Date</th>
                  <th>Item</th>
                  <th>Carbon Emission(kg)</th>
                  <th>Cost</th>
                </tr>
                  <% @intervals.each do |interval| %>
                    <% interval.receipts.each do |receipt| %>
                  <tr>
                    <td><%= receipt.date.strftime("%B %e, %Y") %></td>
                    <td><%= receipt.kind %></td>
                    <td>
                      <% if receipt.emission == "0.0" %>
                      <%= "N/A" %>
                      <% else %>
                      <%= receipt.emission %>
                      <% end %>
                    </td>
                    <td>$<%= receipt.cost %></td>
                  </tr>
                    <% end %>
                  <% end %>
              </tbody>
            </table>
      </div><!--category box end-->


      </div> <!---dashboard end col-3-3 -->
  </div><!--wrapper end-->
</div> <!--container end-->



<!-- Modal -->
  <div id="accountModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
        <h4 id="myModalLabel">Add an account to track!</h4>
    </div>
    <div class="modal-body">
      <div class="span6">
          <%= form_tag :controller => "Users", :action => "add_account", :method => 'post', :class => "horizontal" do %>
              <div class="controls">
                <%= text_field_tag :bank_name, params[:bank_name], :id => "inputEmail", :placeholder => "Bank ID (4 for Chase or 14007 for BoA)" %>
              </div>
              <div class="controls">
                <%= text_field_tag :bank_username, params[:bank_username], :id => "inputEmail", :placeholder => "Bank Username" %>
              </div>
              <div class="controls">
                <%= text_field_tag :bank_password, params[:bank_password], :id => "inputPassword", :placeholder => "Bank Password", type: "password" %>
              </div>
              <div class="controls">
                <%= text_field_tag :bank_account_order, params[:bank_account_order], :id => "inputEmail", :placeholder => "Desired Bank Account Order in Array (0, 1 , 2, etc...) " %>
              </div>
              <%= submit_tag "Add Account!", :class => 'btn btn-success' %>
          <% end %>
      </div>
    </div>

    <div class="modal-footer">
      <a href="#"></a>
    </div>
  </div>


  <script>$(function(){ $("#pop").popover();});</script>
  <script>
  $(document).ready(function(){
  $('#pop').popover({
    html : true,
    content: function() {
      return $('#popover-form').html();
    }
  });
});</script>





